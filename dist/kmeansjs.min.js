!function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).kmeansjs=f()}(function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var p="function"==typeof require&&require;if(!f&&p)return p(i,!0);if(u)return u(i,!0);throw(p=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",p}p=n[i]={exports:{}},e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){exports.kmeans=function(){var gColors=null;const radius=5;var svg=null,prevRoots=null,gHeight=null,gWidth=null,gSelectedDataSet=null,gSelectedColumns=null,xp=null,yp=null,xColumnName=null,yColumnName=null;function emptyChild(ele){for(;ele.firstChild;)ele.removeChild(ele.firstChild)}function pickItemsRandomly(k){for(var items=[];items.length<k;){var idx=(idx=gSelectedDataSet.length,Math.floor(Math.random()*Math.floor(idx)));items.includes(idx)||items.push(idx)}return items}function kmeans(roots,x,y){for(var x1,y1,y2,distances=[],i=0;i<roots.length;i++)distances.push({d:(x1=roots[i].cx,y1=roots[i].cy,y2=y,Math.sqrt(Math.pow(x1-x,2)+Math.pow(y1-y2,2))),color:roots[i].color});return distances.sort((a,b)=>a.d>b.d?1:-1),distances[0].color}function buildKmeansHtml(td){var divBtn=document.createElement("div"),input=document.createElement("button");input.addEventListener("click",function(){initInternal(),async function(){var k=parseInt(document.getElementById("kvalue").value);document.getElementById("btnStart").disabled=!0;var items=pickItemsRandomly(k);var roots=function(items){for(var roots=[],i=0;i<items.length;i++){const selected=svg.select(`circle[idx='${items[i]}']`);roots.push({cx:selected.attr("cx"),cy:selected.attr("cy"),color:gColors[i]})}return roots}(items);var iter=parseInt(document.getElementById("iter").value);for(var i=0;i<iter;i++){for(var groups={},c=0;c<gColors.length;c++)groups[gColors[c]]=[];!function(roots,iter,totalIter){for(var i=0;i<roots.length;i++){var star=d3.symbol().type(d3.symbolStar).size(80);const center=svg.append("g").append("path").attr("d",star).attr("class","roots").attr("transform",`translate(${roots[i].cx}, ${roots[i].cy})`).style("stroke","black").style("fill",roots[i].color),text=svg.append("text").attr("y",roots[i].cy).attr("x",roots[i].cx).attr("dy","1.25em").style("text-anchor","middle").text(iter);1!=iter&&iter!=totalIter&&text.transition().duration(2500).style("opacity",0),iter!=totalIter&&center.transition().duration(2500).style("opacity",0),1!=iter&&svg.append("line").attr("x1",prevRoots[i].cx).attr("x2",roots[i].cx).attr("y1",prevRoots[i].cy).attr("y2",roots[i].cy).attr("stroke","black").attr("stroke-width",2)}}(roots,i+1,iter),prevRoots=roots,svg.selectAll("circle.training").style("fill",function(d){var color=kmeans(roots,d3.select(this).attr("cx"),d3.select(this).attr("cy"));return groups[color].push({x:d3.select(this).attr("cx"),y:d3.select(this).attr("cy")}),color}),roots=function(groups){var roots=[];return Object.keys(groups).forEach(function(key){for(var xCenter=0,yCenter=0,i=0;i<groups[key].length;i++)xCenter+=parseFloat(groups[key][i].x),yCenter+=parseFloat(groups[key][i].y);roots.push({cx:xCenter/groups[key].length,cy:yCenter/groups[key].length,color:key})}),roots}(groups);var divOut=document.createElement("div"),status=document.createElement("div");status.innerText=`iteration: ${i+1}`,divOut.appendChild(status);for(var j=0;j<k;j++){var divX=document.createElement("div");divX.style.background=roots[j].color,divX.innerHTML=`${xColumnName}: ${xp(roots[j].cx)}`;var divY=document.createElement("div");divY.style.background=roots[j].color,divY.innerHTML=`${yColumnName}: ${yp(roots[j].cy)}`,divOut.appendChild(divX),divOut.appendChild(divY)}divOut.appendChild(document.createElement("hr"));status=document.getElementById("status");status.appendChild(divOut),await function(ms){return new Promise(resolve=>setTimeout(resolve,ms))}(750),status.scrollTo(0,status.scrollHeight)}document.getElementById("btnStart").disabled=!1}()}),input.setAttribute("id","btnStart"),input.innerText="Start",divBtn.appendChild(input);var select=document.createElement("select");select.setAttribute("name","kvalue"),select.setAttribute("id","kvalue");var divStatus=document.createElement("option");divStatus.innerText="3",select.appendChild(divStatus);var h3=document.createElement("option");h3.innerText="4",select.appendChild(h3);var labelIter=document.createElement("option");labelIter.innerText="5",select.appendChild(labelIter),select.addEventListener("change",function(){initInternal()});var labelK=document.createElement("label");labelK.setAttribute("for","kvalue"),labelK.innerText="Choose a value for K: ";var divDl=document.createElement("div"),input=document.createElement("dl");input.setAttribute("id","legend"),input.setAttribute("class","kmeans-dl"),divDl.appendChild(input);divStatus=document.createElement("div");divStatus.setAttribute("id","status"),divStatus.style.border="1px solid black",divStatus.style.height="400px",divStatus.style.overflowY="scroll";h3=document.createElement("h3");h3.innerText="Status";labelIter=document.createElement("label");labelIter.innerText="Iterations: ";input=document.createElement("input");input.setAttribute("type","text"),input.setAttribute("value","10"),input.setAttribute("id","iter"),td.appendChild(labelK),td.appendChild(select),td.appendChild(divDl),td.appendChild(labelIter),td.appendChild(input),td.appendChild(divBtn),td.appendChild(h3),td.appendChild(divStatus)}let publicScope={};function initInternal(){const xColName=gSelectedColumns[0],yColName=gSelectedColumns[1];xColumnName=xColName,yColumnName=yColName,d3.select("div#kmeans-data-vis > *").remove(),emptyChild(document.getElementById("status")),emptyChild(document.getElementById("legend"));var margin_top=10,k=30,x=40,y=60,width=gWidth-y-k,height=gHeight-margin_top-x;svg=d3.select("#kmeans-data-vis").append("svg").attr("width",width+y+k).attr("height",height+margin_top+x).append("g").attr("transform","translate("+y+","+margin_top+")");var xMinVal=Math.min(...gSelectedDataSet.map(ele=>ele[xColName])),xMaxVal=Math.max(...gSelectedDataSet.map(ele=>ele[xColName])),yMinVal=Math.min(...gSelectedDataSet.map(ele=>ele[yColName])),yMaxVal=Math.max(...gSelectedDataSet.map(ele=>ele[yColName])),k=Math.max(xMaxVal-xMinVal,yMaxVal-yMinVal)/7,x=d3.scaleLinear().domain([xMinVal-k,xMaxVal+k]).range([0,width]);xp=d3.scaleLinear().domain([0,width]).range([xMinVal-k,xMaxVal+k]),svg.append("g").attr("transform",`translate(0,${height})`).call(d3.axisBottom(x)),svg.append("text").attr("transform",`translate(${width/2}, ${height+margin_top+20})`).style("text-anchor","middle").text(xColName),svg.append("text").attr("transform","rotate(-90)").attr("y",0-y).attr("x",0-height/2).attr("dy","1em").style("text-anchor","middle").text(yColName);y=d3.scaleLinear().domain([yMinVal-k,yMaxVal+k]).range([height,0]);yp=d3.scaleLinear().domain([height,0]).range([yMinVal-k,yMaxVal+k]),svg.append("g").call(d3.axisLeft(y));k=parseInt(document.getElementById("kvalue").value);gColors=gColors.slice(0,k),function(k){for(var legend=document.getElementById("legend"),i=0;i<k;++i){var dd=document.createElement("dt");dd.setAttribute("style",`float: left; width: 20px; height: 20px; vertical-align: middle; background: ${gColors[i]}`),legend.appendChild(dd);dd=document.createElement("dd");dd.innerText=`Group ${i+1}`,legend.appendChild(dd)}}(k),function(x,y,xColName,yColName){svg.append("g").selectAll("dot").data(gSelectedDataSet).enter().append("circle").attr("idx",function(d,i){return i}).attr("class","training").attr("cx",function(d){return x(d[xColName])}).attr("cy",function(d){return y(d[yColName])}).attr("r",radius).style("fill",function(d){return"black"})}(x,y,xColName,yColName)}return publicScope.init=function(divViz,td2){var table,tr,td1;!function(options){return!(null==options.selectedDataSet||options.selectedDataSet.length<=0)&&!(null==options.selectedColumns||options.selectedColumns.length<2)}(td2)||(td2=function(a,b){for(var key in b)b.hasOwnProperty(key)&&(a[key]=b[key]);return a}({colors:["#FFB000","#DC267F","#648FFB","#785EF0"],height:640,width:690,selectedDataSet:null,selectedColumns:null},td2),gColors=td2.colors,gHeight=td2.height,gWidth=td2.width,gSelectedDataSet=td2.selectedDataSet,gSelectedColumns=td2.selectedColumns,divViz.replaceChildren(),divViz.appendChild((table=document.createElement("table"),tr=document.createElement("tr"),td1=document.createElement("td"),td2=document.createElement("td"),(divViz=document.createElement("div")).setAttribute("id","kmeans-data-vis"),buildKmeansHtml(td2),td1.appendChild(divViz),tr.appendChild(td1),tr.appendChild(td2),table.appendChild(tr),table)),initInternal())},publicScope}},{}]},{},[1])(1)});
